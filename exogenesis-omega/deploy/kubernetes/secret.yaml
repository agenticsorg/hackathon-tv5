# TEMPLATE: Secrets for Exogenesis Omega
# WARNING: This is a template. DO NOT commit actual secrets to version control.
#
# Usage:
#   1. Copy this file: cp secret.yaml secret-actual.yaml
#   2. Replace all <PLACEHOLDER> values with actual secrets
#   3. Apply: kubectl apply -f secret-actual.yaml
#   4. Add secret-actual.yaml to .gitignore

apiVersion: v1
kind: Secret
metadata:
  name: ruvector-postgres-secret
  namespace: omega-system
  labels:
    app: ruvector-postgres
    component: database
type: Opaque
stringData:
  # Database credentials
  username: omega
  password: <REPLACE_WITH_STRONG_PASSWORD>  # Generate with: openssl rand -base64 32

  # Connection URLs
  primary_url: "postgres://omega:<REPLACE_WITH_STRONG_PASSWORD>@ruvector-postgres-primary:5432/omega?sslmode=require"

  replica_urls: "postgres://omega:<REPLACE_WITH_STRONG_PASSWORD>@ruvector-postgres-1.ruvector-postgres:5432/omega?sslmode=require,postgres://omega:<REPLACE_WITH_STRONG_PASSWORD>@ruvector-postgres-2.ruvector-postgres:5432/omega?sslmode=require"

  all_urls: "postgres://omega:<REPLACE_WITH_STRONG_PASSWORD>@ruvector-postgres-0.ruvector-postgres:5432/omega?sslmode=require,postgres://omega:<REPLACE_WITH_STRONG_PASSWORD>@ruvector-postgres-1.ruvector-postgres:5432/omega?sslmode=require,postgres://omega:<REPLACE_WITH_STRONG_PASSWORD>@ruvector-postgres-2.ruvector-postgres:5432/omega?sslmode=require"

---
apiVersion: v1
kind: Secret
metadata:
  name: constellation-tls
  namespace: omega-system
  labels:
    app: constellation
    component: server
type: kubernetes.io/tls
stringData:
  # TLS certificate for gRPC
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    <REPLACE_WITH_TLS_CERTIFICATE>
    -----END CERTIFICATE-----

  tls.key: |
    -----BEGIN PRIVATE KEY-----
    <REPLACE_WITH_TLS_PRIVATE_KEY>
    -----END PRIVATE KEY-----

  ca.crt: |
    -----BEGIN CERTIFICATE-----
    <REPLACE_WITH_CA_CERTIFICATE>
    -----END CERTIFICATE-----

---
apiVersion: v1
kind: Secret
metadata:
  name: device-attestation
  namespace: omega-system
  labels:
    app: constellation
    component: server
type: Opaque
stringData:
  # Device attestation keys for TV authentication
  attestation_public_key: |
    -----BEGIN PUBLIC KEY-----
    <REPLACE_WITH_ATTESTATION_PUBLIC_KEY>
    -----END PUBLIC KEY-----

  attestation_private_key: |
    -----BEGIN PRIVATE KEY-----
    <REPLACE_WITH_ATTESTATION_PRIVATE_KEY>
    -----END PRIVATE KEY-----

---
# Instructions for generating secrets:
#
# 1. PostgreSQL password:
#    openssl rand -base64 32
#
# 2. TLS certificates (for production, use cert-manager or cloud provider):
#    openssl req -x509 -newkey rsa:4096 -nodes -keyout tls.key -out tls.crt -days 365 -subj "/CN=constellation.omega.internal"
#
# 3. Device attestation keys:
#    openssl genrsa -out attestation_private.key 4096
#    openssl rsa -in attestation_private.key -pubout -out attestation_public.key
#
# 4. Apply secrets with encryption at rest enabled in your cluster:
#    kubectl apply -f secret-actual.yaml
#
# 5. Verify secrets are encrypted:
#    kubectl get secret ruvector-postgres-secret -n omega-system -o yaml
